diff -up mozilla/storage/build/Makefile.in.sqlite mozilla/storage/build/Makefile.in
--- mozilla/storage/build/Makefile.in.sqlite	2007-08-10 18:19:57.000000000 +0200
+++ mozilla/storage/build/Makefile.in	2007-12-13 12:06:36.000000000 +0100
@@ -21,7 +21,6 @@
 #
 # Contributor(s):
 #   Vladimir Vukicevic <vladimir.vukicevic@oracle.com>
-#   Shawn Wilsher <me@shawnwilsher.com>
 #
 # Alternatively, the contents of this file may be used under the terms of
 # either of the GNU General Public License Version 2 or later (the "GPL"),
@@ -71,10 +70,9 @@ LOCAL_INCLUDES = \
 
 SHARED_LIBRARY_LIBS = \
 	../src/$(LIB_PREFIX)storage_s.$(LIB_SUFFIX) \
+	$(DEPTH)/db/sqlite3/src/$(LIB_PREFIX)sqlite3_s.$(LIB_SUFFIX) \
 	$(NULL)
 
-EXTRA_DSO_LIBS += sqlite3
-
 EXTRA_DSO_LDOPTS += \
 	$(LIBS_DIR) \
 	$(EXTRA_DSO_LIBS) \
diff -up mozilla/toolkit/library/libxul-config.mk.sqlite mozilla/toolkit/library/libxul-config.mk
--- mozilla/toolkit/library/libxul-config.mk.sqlite	2007-12-08 02:38:35.000000000 +0100
+++ mozilla/toolkit/library/libxul-config.mk	2007-12-13 12:06:36.000000000 +0100
@@ -21,7 +21,6 @@
 # the Initial Developer. All Rights Reserved.
 #
 # Contributor(s):
-#   Shawn Wilsher <me@shawnwilsher.com>
 #
 # Alternatively, the contents of this file may be used under the terms of
 # either of the GNU General Public License Version 2 or later (the "GPL"),
@@ -223,7 +222,6 @@ endif
 
 ifdef MOZ_STORAGE
 COMPONENT_LIBS += storagecomps
-EXTRA_DSO_LIBS += sqlite3
 endif
 
 ifdef MOZ_PLACES
diff -up mozilla/xpcom/stub/Makefile.in.sqlite mozilla/xpcom/stub/Makefile.in
--- mozilla/xpcom/stub/Makefile.in.sqlite	2007-10-13 23:13:52.000000000 +0200
+++ mozilla/xpcom/stub/Makefile.in	2007-12-13 12:06:36.000000000 +0100
@@ -91,7 +91,6 @@ DEPENDENT_LIBS_LIST += \
 ifdef MOZ_ENABLE_LIBXUL
 
 DEPENDENT_LIBS_LIST += \
-	$(LIB_PREFIX)sqlite3$(DLL_SUFFIX) \
 	$(LIB_PREFIX)softokn3$(DLL_SUFFIX) \
 	$(LIB_PREFIX)nss3$(DLL_SUFFIX) \
 	$(LIB_PREFIX)ssl3$(DLL_SUFFIX) \
diff -up mozilla/config/static-config.mk.sqlite mozilla/config/static-config.mk
--- mozilla/config/static-config.mk.sqlite	2007-07-24 00:02:20.000000000 +0200
+++ mozilla/config/static-config.mk	2007-12-13 12:06:36.000000000 +0100
@@ -98,10 +98,6 @@ ifdef MOZ_ENABLE_PANGO
 STATIC_EXTRA_LIBS	+= $(MOZ_PANGO_LIBS)
 endif
 
-ifdef MOZ_STORAGE
-EXTRA_DSO_LIBS += sqlite3
-endif
-
 ifdef MOZ_ENABLE_STARTUP_NOTIFICATION
 STATIC_EXTRA_LIBS	+= $(MOZ_STARTUP_NOTIFICATION_LIBS)
 endif
diff -up mozilla/config/system-headers.sqlite mozilla/config/system-headers
--- mozilla/config/system-headers.sqlite	2007-10-12 14:34:46.000000000 +0200
+++ mozilla/config/system-headers	2007-12-13 12:06:36.000000000 +0100
@@ -617,8 +617,6 @@ SIOUX.h
 size_t.h
 someincludefile.h
 Sound.h
-sqlite3.h
-sqlite3file.h
 ssdef.h
 sslerr.h
 ssl.h
diff -up mozilla/db/sqlite3/src/sqlite3file.h.sqlite mozilla/db/sqlite3/src/sqlite3file.h
--- mozilla/db/sqlite3/src/sqlite3file.h.sqlite	2007-07-25 04:18:54.000000000 +0200
+++ mozilla/db/sqlite3/src/sqlite3file.h	2007-12-13 12:06:36.000000000 +0100
@@ -199,11 +199,7 @@ struct sqlite3OsVtbl {
   /*
   ** Files other than os.c just reference the global virtual function table. 
   */
-#ifdef XP_WIN
-  extern __declspec(dllimport) struct sqlite3OsVtbl sqlite3Os;
-#else
   extern struct sqlite3OsVtbl sqlite3Os;
-#endif // windows symbol ifdef
 #endif /* _SQLITE_OS_C_ */
 
 } // extern "C"
diff -up mozilla/db/sqlite3/src/Makefile.in.sqlite mozilla/db/sqlite3/src/Makefile.in
--- mozilla/db/sqlite3/src/Makefile.in.sqlite	2007-12-01 08:17:37.000000000 +0100
+++ mozilla/db/sqlite3/src/Makefile.in	2007-12-13 12:12:37.000000000 +0100
@@ -45,10 +45,10 @@ VPATH		= @srcdir@
 include $(DEPTH)/config/autoconf.mk
 
 MODULE           = sqlite3
-LIBRARY_NAME     = sqlite3
-FORCE_SHARED_LIB = 1
-VISIBILITY_FLAGS =
-LIB_IS_C_ONLY = 1
+LIBRARY_NAME     = sqlite3_s
+MODULE_NAME      = sqlite3
+FORCE_STATIC_LIB = 1
+LIB_IS_C_ONLY    = 1
 
 ifeq (,$(filter-out WINNT WINCE,$(OS_ARCH)))
 ifndef GNU_CC
@@ -85,6 +85,9 @@ endif
 endif
 
 include $(topsrcdir)/config/rules.mk
+    
+sqlite-shell.$(OBJ_SUFFIX): shell.c
+	$(ELOG) $(CC) $(OUTOPTION)$@ -c $(COMPILE_CFLAGS) $(_VPATH_SRCS)
 
 # next line allows use of MOZ_OBJDIR in .mozconfig with older gcc on BeOS, maybe others
 LOCAL_INCLUDES += -I$(srcdir)
